Настройки Arduino IDE
---------------------

* Плата: Arduino Nano
* Процессор: ATmega328P (Old Bootloader)
* Порт: меняется, нужно определить самостоятельно

![arduino ide](/docs/arduino_ide.jpg "arduino ide")


Используемые библиотеки
-----------------------

* MAX6675 library by Adafruit Version 1.1.0 - датчик температуры
* LiquidCrystal I2C by Frank de Brabander Version 1.1.2 - экран через I2C GPIO Expander
* RotaryEncoder by Matthias Hertel Version 1.1.0 - энкодер

Назначение контактов
--------------------

| Назначение | Контакт | Контакт | Назначение |
| --- | --- | --- | --- |
| Debug Transmit | TX | VIN |  |
| Debug Receive | RX | GND | Power Ground |
|  | RST | RST |Button Reset  |
|  | GND | 5V | Power 5 Volts |
|  | D2 | A7 | Turbidity Sensor |
| MAX6675 Chip Select | D3 | A6 |  |
| Relay Buzzer | D4 | A5 | I2C SCL |
| Relay Valve Open | D5 | A4 | I2C SDA |
| Relay Valve Power | D6 | A3 |  |
| Relay Mixer Motor | D7 | A2 |  |
| Encoder A | D8 | A1 | Button Start (D15) |
| Encoder B | D9 | A0 |  |
|  | D10 | REF |  |
|  | D11 | 3V3 |  |
| MAX6675 Slave Out | D12 | D13 | MAX6675 Clock |
|  | USB | USB |  |

Вход в режим настройки
----------------------

* Нажать и держать зеленую кнопку
* Нажать и отпустить красную кнопку
* Отпустить зеленую кнопку после появления текста на экране

Настройки системы
-----------------

* __TEMP MIN__ _(0)_ - минимальная допустимая температура. Значения ниже считаются ошибочными и отбрасываются.
* __TEMP MAX__ _(1)_ - максимальная допустимая температура. Значения выше считаются ошибочными и отбрасываются. Также используется как целевая температура до задания новой из шага типа __TEMP__
* __VALVE TIME__ _(2)_ - время полного открывания/закрывания клапана в секундах. По достижении этого времени система не пытается открыть/закрыть клапан ещё больше.
* __VALVE INV__ _(3)_ - инверсия открывания/закрывания клапана. 0 - нормальное управление, 1 - инвертированное.
* __TEMP INTVL__ _(4)_ - интервал пересчета необходимого положения клапана в секундах. Раз в указанный период система вычисляет новое положение клапана в зависимости от разницы текущей и заданной температур.
* __TEMP TIME__ _(5)_ - коэффициент пересчета положения клапана. Умножается на разницу текущей и заданной температур для вычисления времени открывания/закрывания клапана в секундах.
* __COEF A__ _(6)_ - коэффициент коррекции температуры A, целая часть
* __A/100__ _(7)_ - коэффициент коррекции температуры A, дробная часть _(сотые доли)_
* __COEF B__ _(6)_ - коэффициент коррекции температуры B, целая часть
* __B/100__ _(7)_ - коэффициент коррекции температуры B, дробная часть _(сотые доли)_

Коррекция температуры проводится по формуле `t = a*x + b`, где x - температура, полученная от датчика

Типы шагов программы
--------------------

* __STOP__ - нет контроля охлаждения, ожидание нажатия кнопки
* __TEMP__ - контроль охлаждения, ожидание заданной температуры
* __TIME__ - контроль охлаждение, выдержка в течение заданного времени
* __WAIT__ - контроль охлаждения, ожидание нажатия кнопки

Температура измеряется и отображается на всех этапах программы.

Описание экрана системы
-----------------------

Внешний вид экрана:
```
T:71.5>62 C:  53
S: 9 TIME V11>20
```

* __T:71.5__ - текущее значение температуры. 
* __>62__ - заданная температура, которую системы пытается достичь. Если вместо символа __>__ отображается буква __E__, значит при измерении температуры произошла ошибка. После успешного измерения вместо буквы __E__ снова отобразится символ __>__.
* __C:  53__ - таймер обратного отсчета.
* __S: 9__ - номер текущего шага программы.
* __TIME__ - тип текущего шага программы или прозрачность в процентах
* __V11__ - текущее время закрытия клапана в секундах.
* __>20__ - целевое время закрытия клапана в секундах.

Если время закрытия клапана = 0, значит он максимально открыт и охлажение минимальное. Максимальное время закрытия соответствует максимальному уровню охлаждения.
